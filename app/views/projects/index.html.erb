<% content_for :title, "All Projects" %>

<header>
  <h1>Projects</h1>
  <%= form_with url: new_project_path, method: :get, local: true, style: "display: inline-block;" do |form| %>
    <%= form.submit "New Project" %>
  <% end %>
</header>

<% @projects.each do |project| %>
  <% latest_run = latest_run_for_project(project) %>
  <article>
    <header>
      <h2><%= link_to project.name, project_path(project) %></h2>
    </header>

    <% if latest_run %>
      <p><small>Latest: <%= time_ago_in_words(latest_run.ran_at) %> ago</small></p>

      <p>Coverage: <strong><%= number_to_percentage(latest_run.coverage, precision: 1) %></strong></p>
      <meter value="<%= latest_run.coverage %>" max="100" style="width: 100%;"><%= latest_run.coverage %>%</meter>

      <table>
        <tr>
          <td>Ruby Specs</td>
          <td><%= latest_run.ruby_specs %></td>
        </tr>
        <tr>
          <td>JS Specs</td>
          <td><%= latest_run.js_specs %></td>
        </tr>
        <tr>
          <td>Runtime</td>
          <td><%= latest_run.runtime.round %>s</td>
        </tr>
      </table>

      <p>
        <small>Branch: <code><%= latest_run.branch %></code></small>
      </p>
    <% else %>
      <p>No test runs yet</p>
      <p><small>API Key: <code><%= project.api_key[0..10] %>...</code></small></p>
    <% end %>

    <footer>
      <%= link_to "View Details", project_path(project) %>
      <%= link_to "Edit", edit_project_path(project) %>
      <% if latest_run %>
        <small><%= run_count_for_project(project) %> runs</small>
      <% end %>
    </footer>
  </article>
<% end %>

<% if @projects.empty? %>
  <section>
    <h2>No projects yet</h2>
    <p>Create your first project to start tracking test metrics</p>
    <p><%= link_to "Create Project", new_project_path %></p>
  </section>
<% end %>